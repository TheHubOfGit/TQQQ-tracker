<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TQQQ Tracker</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
</head>

<body>
    <div class="app-container">
        <header>
            <div class="ticker">TQQQ</div>
            <div class="company-name">ProShares UltraPro QQQ</div>
            <div class="price-container">
                <span id="current-price" class="price">$0.00</span>
            </div>
            <div class="stats-container">
                <span id="price-change" class="change">+$0.00 (0.00%)</span>
                <span class="period">Today</span>
            </div>
        </header>

        <div class="chart-wrapper">
            <div id="chart"></div>
        </div>

        <div class="time-filters">
            <button class="active">1D</button>
            <button>1W</button>
            <button>1M</button>
            <button>3M</button>
            <button>1Y</button>
            <button>ALL</button>
        </div>

        <footer>
            <p>Updated: <span id="last-updated">--</span></p>
        </footer>
    </div>

    <script>
        async function fetchData() {
            try {
                // Fetch from GitHub Raw to bypass Cloudflare build cache/limits for data
                const response = await fetch('https://raw.githubusercontent.com/TheHubOfGit/TQQQ-tracker/main/public/data.json');
                const data = await response.json();

                // Update Header Info
                const meta = data.meta;
                document.getElementById('current-price').textContent = `$${meta.current_price.toFixed(2)}`;

                const sign = meta.price_change >= 0 ? '+' : '';
                document.getElementById('price-change').textContent = `${sign}${meta.price_change.toFixed(2)} (${meta.percent_change.toFixed(2)}%)`;

                // Color theme based on performance
                const themeColor = meta.is_positive ? '#00c805' : '#ff5000';
                document.documentElement.style.setProperty('--accent', themeColor);
                document.getElementById('price-change').style.color = themeColor;

                // Chart Traces
                const trace1 = {
                    x: data.dates,
                    y: data.prices,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'TQQQ',
                    line: { color: themeColor, width: 2 },
                    hovertemplate: '$%{y:.2f}<extra></extra>'
                };

                const trace2 = {
                    x: data.dates,
                    y: data.sma50,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'SMA 50 (Daily)',
                    line: { color: 'rgba(255, 215, 0, 0.6)', width: 1.5 }, // Gold
                    hovertemplate: '$%{y:.2f}<extra></extra>'
                };

                const trace3 = {
                    x: data.dates,
                    y: data.sma100,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'SMA 100 (Daily)',
                    line: { color: 'rgba(255, 255, 255, 0.4)', width: 1.5 }, // White/Grey
                    hovertemplate: '$%{y:.2f}<extra></extra>'
                };

                const layout = {
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    plot_bgcolor: 'rgba(0,0,0,0)',
                    font: { family: 'DIN, Inter, sans-serif', color: '#fff' },
                    xaxis: {
                        type: 'category', // Removes gaps (non-trading days/hours)
                        showgrid: false,
                        zeroline: false,
                        showticklabels: false,
                        fixedrange: true
                        // hoverformat removed because we are sending formatted strings
                    },
                    yaxis: {
                        showgrid: false,
                        zeroline: false,
                        showticklabels: false, // Minimalist: hide y-axis labels like RH
                        fixedrange: true
                    },
                    margin: { t: 20, r: 0, b: 20, l: 0 },
                    showlegend: true,
                    legend: {
                        x: 0,
                        y: 1,
                        bgcolor: 'rgba(0,0,0,0)',
                        font: { size: 10, color: 'rgba(255,255,255,0.5)' }
                    },
                    hovermode: 'x unified',
                    hoverlabel: {
                        bgcolor: '#1e1e1e',
                        font: { color: '#fff' },
                        bordercolor: '#333'
                    }
                };

                const config = {
                    responsive: true,
                    displayModeBar: false,
                    staticPlot: false
                };

                Plotly.newPlot('chart', [trace1, trace2, trace3], layout, config);

                // Update timestamp
                const lastDate = new Date(data.dates[data.dates.length - 1]);
                document.getElementById('last-updated').textContent = lastDate.toLocaleString();

            } catch (error) {
                console.error('Error fetching data:', error);
                document.getElementById('last-updated').textContent = 'Error loading data';
            }
        }

        fetchData();
    </script>
</body>

</html>